# COHEWL - Coherence at Word Level 

## **COHEWL: Assessing the Semantic Coherence of Short Text at the Word Level**

COHEWL: Avaliando a coerência semântica de texto curto a nível da palavra

## **Abstract**

Most text coherence models proposed in the literature focus on sentence ordering and semantic similarity of neighboring sentences. Thus, they can not be applied to documents with just one sentence and do not consider incoherences caused by particular words. This work proposes a framework called COHEWL (COHErence at Word Level) for coherence  classification and measurement based on word semantics. COHEWL also supports contrastive data generation, by exchanging particular words with other ones that fit in the context of short documents. Experiments with documents containing single sentence questions typical of QA in Brazilian Portuguese and English showed that BERT properly trained for the task of discriminating original documents from those with a changed word achieves accuracy between 80% and 99.88%. However, coherence measures calculated with BERT embeddings are less adherent to the human perception of coherence in our dataset than topic coherence measures calculated using a topic model built on top of a domain specific corpus.

**Keywords**: Textual Coherence, Word Semantics, BERT, Topic Models 

## **Directory/folder**

List and description of the main COHEWL directories:

* **dataset** - Directory with datasets.
* **notebooks** - Directory with the notebooks of the experiments.
* **projecao** - Directory with projection files.

## **Installation**

**Requirements**

* Python 3.6.9
* [Transformer Huggingface 4.5.1](https://huggingface.co/transformers/)
* [PyTorch 1.8.1](https://pytorch.org/)
* [Spacy 3.7.13](https://spacy.io/)

**Download - Clone**

```
!git clone https://github.com/osmarbraz/cohewl.git
```

## 1. Dataset

The **"dataset"** folder contains the dataset files used in Portuguese and English.

## 2. Notebooks

The **"notebooks"** folder contains the notebook files used in our experiments. The files are split for each dataset and its language.

## 3. Embedding Projections

Projections of *embeddings* sentences, words and sentences and words generated by **BERT** **large** size using the **Embedding Projector** tool (https://projector.tensorflow.org/).

The files used by the projector are in the **"projecao"** folder and divided into three folders: **"sentenca"**, **"token"** and **"token_sentenca"**. Folders indicate whether consolidated *embeddings* of **sentences**, *embeddings* of **tokens** or combined were used.
Each folder **"sentenca"**, **"token"** and **"token_sentenca"**, has the files for the datasets. The projections occur for the words and sentences of the original (**DO**) and modified (**DM**) documents.

### 3.1 Projections of *embeddings* of sentences

Projections of *embeddings* of sentences consolidated by the average of *embeddings* of tokens. The *embeddings* of the tokens are from the last 4 layers of **BERTimbau Large** in Portuguese or **BERT Large** in English and concatenated.

The projections of *embeddings* of sentences are related to the following **metadata**:
- Sentence
- Id (Document Id)
- Origin (Id of the source document)
- Class (1 - Original and 0 - Modified)

#### The folders **"sentenca/cohquad_cohinc"**, **"sentenca/c_cohquad_coh"**, **"sentenca/c_cohquad_inc"**, **"sentenca/c_faquad"** and **"sentenca /c_squard2"** have projections of *embeddings* separate data files from datasets.

**Links** to **Embedding Projector** configuration files for datasets:

- **CohQuAD Coh+Inc (pt-br):** *config_cohquad_cohinc_ptbr_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_cohquad_cohinc_ptbr_sentenca.json

- **CohQuAD Coh+Inc (en):** *config_cohquad_cohinc_ptbr_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_cohquad_cohinc_en_sentenca.json

- **C(CohQuAD Coh, 20) (pt-br):** *config_c_cohquad_coh_ptbr_20_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_cohquad_coh_ptbr_20_sentenca.json

- **C(CohQuAD Coh, 20) (en):** *config_c_cohquad_coh_en_20_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_cohquad_coh_en_20_sentenca.json

- **C(CohQuAD Inc, 20) (pt-br):** *config_c_cohquad_inc_ptbr_20_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_cohquad_inc_ptbr_20_sentenca.json

- **C(CohQuAD Inc, 20) (en):** *config_c_cohquad_inc_en_20_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_cohquad_inc_en_20_sentenca.json

- **20 C(20 DO FAQuAD, 20) (pt-br):** *config_c_faquad_ptbr_20_sentenca.json*:
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_faquad_ptbr_20_sentenca.json

- **20 C(20 DO SQuAD2, 20) (pt-br):** *config_c_squad2_ptbr_20_sentenca.json*:
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_squad2_ptbr_20_sentenca.json

- **C(20 DO SQuAD2, 20) (en):** *config_c_squad2_en_20_sentenca.json*:
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/sentenca/config_c_squad2_en_20_sentenca.json

### 3.2 Projections of word *embeddings*
Projections of *embeddings* of words consolidated by averaging the *embeddings* of tokens for words that are outside the model's vocabulary. The *embeddings* of the tokens are retrieved from the last 4 layers of **BERTimbau Large** in Portuguese or **BERT Large** in English and concatenated.

The word *embeddings* projections can relate to the following **metadata**:
- Token
- POS Tag
- OOV (1 - Does not exist in the **BERT** vocabulary and combines the *embeddings* of the tokens to form the word and 0 - Exists in the **BERT** vocabulary)
- Id (Document Id)
- Origin (Id of the source document)
- Class (1 - Original and 0 - Modified)
- Disturbed (1 - Modified, 0 - Original)
- Index (Index of the word in the sentence)
- Next sentence token
- Sentence

#### The folders **"token/cohquad_cohinc"**, **"token/c_cohquad_coh"**, **"token/c_cohquad_inc"**, **"token/c_faquad"** and **"token /c_squard2"** have projections of *embeddings* separate data files from datasets.

**Links** to datasets **Embedding Projector** configuration files:

- **CohQuAD Coh+Inc (pt-br)**:
	- **No lines** *config_cohquad_cohinc_ptbr_token.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_cohquad_cohinc_ptbr_token.json
	- **With lines** *config_cohquad_cohinc_ptbr_token_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_cohquad_cohinc_ptbr_token_next.json

- **CohQuAD Coh+Inc (en)**:
	- **No lines** *config_cohquad_cohinc_en_token.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_cohquad_cohinc_en_token.json
	- **With lines** *config_cohquad_cohinc_en_token_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_cohquad_cohinc_en_token_next.json

- **C(CohQuAD Coh, 20) (pt-br)**:
	- **No lines** *config_c_cohquad_coh_ptbr_20_token.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_coh_ptbr_20_token.json
	- **With lines** *config_c_cohquad_coh_ptbr_20_token_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_coh_ptbr_20_token_next.json

- **C(CohQuAD Coh, 20) (en)**:
	- **No lines** *config_c_cohquad_coh_en_20_token.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_coh_en_20_token.json
	- **With lines** *config_c_cohquad_coh_en_20_token_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_coh_en_20_token_next.json

- **C(CohQuAD Inc, 20) (pt-br)**:
	- **No lines** *config_c_cohquad_inc_ptbr_20_token.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_inc_ptbr_20_token.json
	- **With lines** *config_c_cohquad_inc_ptbr_20_token_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_inc_ptbr_20_token_next.json

- **C(CohQuAD Inc, 20) (en)**:
	- **No lines** *config_c_cohquad_inc_en_20_token.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_inc_en_20_token.json
	- **With lines** *config_c_cohquad_inc_en_20_token_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_cohquad_inc_en_20_token_next.json

- **C(20 DO FaQuAD, 20)**:
	- **No lines** *config_c_faquad_ptbr_20_token.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_faquad_ptbr_20_token.json
	- **With lines** *config_c_faquad_ptbr_20_token_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_faquad_ptbr_20_token_next.json

- **C(20 DO SQuAD2, 20) (pt-br)**:
	- **No lines** *config_c_squad2_ptbr_20_token.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_squad2_ptbr_20_token.json
	- **With lines** *config_c_squad2_ptbr_20_token_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_squad2_ptbr_20_token_next.json

- **C(20 DO SQuAD2, 20) (en)**:
	- **No lines** *config_c_squad2_en_20_token.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_squad2_en_20_token.json
	- **With lines** *config_c_squad2_en_20_token_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token/config_c_squad2_en_20_token_next.json

### 3.3 Projections of *embeddings* of words and sentences

Projections of *embeddings* of words and sentences. Word *embeddings* are consolidated by averaging the token *embeddings* for words that are outside the model's vocabulary. The *embeddings* of sentences are consolidated by averaging the *embeddings* of all tokens for words. All *embeddings* are retrieved from the last 4 layers of **BERTimbau Large** in Portuguese or **BERT Large** in English and concatenated.

The projections of word and sentence *embeddings* can relate to the following **metadata**:
- Token (Displays the word or document number)
- POS Tag
- OOV (1 - Does not exist in the **BERT** vocabulary and combines the *embeddings* of the tokens to form the word and 0 - Exists in the **BERT** vocabulary)
- Id (Document Id)
- Origin (Id of the source document)
- Class (1 - Original and 0 - Modified)
- Disturbed (1 - Modified, 0 - Original)
- Index (Index of the word in the sentence)
- Next sentence token
- Granularity (0 - Token, 1 - Sentence)
- Text Type (0 - Modified Word, 1 - Original Word, 2 - Modified Sentence, 3 - Original Sentence)
- Sentence

#### The folders **"token_sentenca/cohquad_cohinc"**, **"token_sentenca/c_cohquad_coh"**, **"token_sentenca/c_cohquad_inc"**, **"token_sentenca/c_faquad"** and **"token_sentenca /c_squad2"** have projections of *embeddings* separate data files from datasets.

**Links** to datasets **Embedding Projector** configuration files:

- **CohQuAD Coh+Inc (pt-br)**:
	- **No lines** *config_cohquad_cohinc_ptbr_token_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_cohquad_cohinc_ptbr_token_sentenca.json
	- **With lines** *config_cohquad_cohinc_ptbr_token_sentenca_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_cohquad_cohinc_ptbr_token_sentenca_next.json

- **CohQuAD Coh+Inc (en)**:
	- **No lines** *config_cohquad_cohinc_en_token_sentenca.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_cohquad_cohinc_en_token_sentenca.json
	- **With lines** *config_cohquad_cohinc_en_token_sentenca_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_cohquad_cohinc_en_token_sentenca_next.json

- **C(CohQuAD Coh, 20) (pt-br)**:
	- **No lines** *config_c_cohquad_coh_ptbr_20_token_sentenca.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_coh_ptbr_20_token_sentenca.json
	- **With lines** *config_c_cohquad_coh_ptbr_20_token_sentenca_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_coh_ptbr_20_token_sentenca_next.json

- **C(CohQuAD Coh, 20) (en)**:
	- **No lines** *config_c_cohquad_coh_en_20_token_sentenca.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_coh_en_20_token_sentenca.json
	- **With lines** *config_c_cohquad_coh_en_20_token_sentenca_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_coh_en_20_token_sentenca_next.json

- **C(CohQuAD Inc, 20) (pt-br)**:
	- **No lines** *config_c_cohquad_inc_ptbr_20_token_sentenca.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_inc_ptbr_20_token_sentenca.json
	- **With lines** *config_c_cohquad_inc_ptbr_20_token_sentenca_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_inc_ptbr_20_token_sentenca_next.json

- **C(CohQuAD Inc, 20) (en)**:
	- **No lines** *config_c_cohquad_inc_en_20_token_sentenca.json* sem linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_inc_en_20_token_sentenca.json
	- **With lines** *config_c_cohquad_inc_en_20_token_sentenca_next.json* com linhas: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_cohquad_inc_en_20_token_sentenca_next.json

- **C(20 DO FaQuAD, 20)**:
	- **No lines** *config_c_faquad_ptbr_20_token_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_faquad_ptbr_20_token_sentenca.json
	- **With lines** *config_c_faquad_ptbr_20_token_sentenca_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_faquad_ptbr_20_token_sentenca_next.json

- **C(20 DO SQuAD2, 20) (pt-br)**:
	- **No lines** *config_c_squad2_ptbr_20_token_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_squad2_ptbr_20_token_sentenca.json
	- **With lines** *config_c_squad2_ptbr_20_token_sentenca_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_squad2_ptbr_20_token_sentenca_next.json

- **C(20 DO SQuAD2, 20) (en)**:
	- **No lines** *config_c_squad2_en_20_token_sentenca.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_squad2_en_20_token_sentenca.json
	- **With lines** *config_c_squad2_en_20_token_sentenca_next.json*: 
https://projector.tensorflow.org/?config=https://raw.githubusercontent.com/osmarbraz/cohewl/main/projecao/token_sentenca/config_c_squad2_en_20_token_sentenca_next.json

## References

**BERTimbau** : Souza, F., Nogueira, R., Lotufo, R., 2020. Bertimbau: Pretrained bert models for brazilian portuguese, in: Brazilian Conference on Intelligent Systems, Springer. Springer, Rio Grande, Brazil. pp. 403–417. https://link.springer.com/chapter/10.1007/978-3-030-61377-8_28

**Embedding Projector** : Smilkov, D., Thorat, N., Nicholson, C., Reif, E., Vi ́egas, F.B., Wattenberg, M., 2016. Embedding projector: Interactive visualization and interpretation of embeddings. arXiv preprint arXiv:1611.05469. https://arxiv.org/pdf/1611.05469.pdf
